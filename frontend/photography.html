<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>photo</title>
  </head>
  <body>
    <form method="POST" action="/photography/create">
      <label for="title">Title:</label>
      <input type="text" id="title" name="title" /><br />

      <label for="image">Image URL:</label>
      <input type="text" id="image" name="image" /><br />

      <div id="occasions">
        <div class="occasion">
          <label for="occasion_0">Occasion:</label>
          <input type="text" id="occasion_0" name="occasions[]" /><br />
          <div class="slots">
            <div class="slot">
              <label for="time_0_0">Time:</label>
              <input
                type="text"
                id="time_0_0"
                name="occasions[0][slots][][time]"
              />
            
            </div>
          </div>
          <button type="button" onclick="addSlot(0)">Add Slot</button><br />
        </div>
      </div>
      <button type="button" onclick="addOccasion()">Add Occasion</button><br />

      <label for="address">Address:</label>
      <input type="text" id="address" name="address" /><br />

      <label for="charges">Charges:</label>
      <input type="text" id="charges" name="charges" /><br />

      <label for="location">Location:</label>
      <input type="text" id="location" name="location" /><br />

      <label for="workingtime">Working Time:</label>
      <input type="text" id="workingtime" name="workingtime" /><br />

      <label for="contact">Contact:</label>
      <input type="text" id="contact" name="contact" /><br />

      <button type="button" onclick="photography_register()">Submit</button>
    </form>
  </body>
</html>
<script>
const photography_register = async () => {
  const occasions = [...document.querySelectorAll('[name="occasions[]"]')].map((el) => {
    return {
      name: el.value,
      slots: [...el.parentNode.querySelectorAll('[name="time[]"]')].map((slot) => {
        return {
          time: slot.value
        }
      })
    }
  });
  
  const payload = {
    title: document.getElementById("title").value,
    image: document.getElementById("image").value,
    occasion: occasions,
    address: document.getElementById("address").value,
    charges: document.getElementById("charges").value,
    location: document.getElementById("location").value,
    workingtime: document.getElementById("workingtime").value,
    contact: document.getElementById("contact").value,
  };
  
  console.log(payload);
  
  await fetch("http://localhost:8080/photography/create", {
    method: "POST",
    headers: {
      "content-type": "application/json",
    },
    body: JSON.stringify(payload),
  })
  .then((res) => res.json())
  .then((res) => console.log(res))
  .catch((err) => console.log(err));
};

let occasionCount = 0;

function addOccasion() {
  occasionCount++;
  const div = document.createElement("div");
  div.innerHTML = `<label for="occasion_${occasionCount}">Occasion:</label>
                   <input type="text" id="occasion_${occasionCount}" name="occasions[]">
                   <div class="slots">
                     <div class="slot">
                       <label for="time_${occasionCount}_0">Time:</label>
                       <input type="text" id="time_${occasionCount}_0" name="time[]">
                     </div>
                   </div>
                   <button type="button" onclick="addSlot(${occasionCount})">Add Slot</button><br>`;
  document.getElementById("occasions").appendChild(div);
}

function addSlot(occasionIndex) {
  const occasionDiv = document.getElementById(`occasion_${occasionIndex}`).parentNode;
  const slotCount = occasionDiv.querySelectorAll('.slot').length;
  const div = document.createElement("div");
  div.innerHTML = `<div class="slot">
                     <label for="time_${occasionIndex}_${slotCount}">Time:</label>
                     <input type="text" id="time_${occasionIndex}_${slotCount}" name="time[]">
                   </div>`;
  occasionDiv.querySelector('.slots').appendChild(div);
}

</script>
